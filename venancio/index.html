<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Top 30</title>
	<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
	<style>
.material-symbols-outlined {
  font-variation-settings:
  'FILL' 0,
  'wght' 400,
  'GRAD' 0,
  'opsz' 24
}
</style>
	<style>
  @import url('https://fonts.googleapis.com/css2?family=Montserrat&display=swap');
</style>
	<style type="text/css">
		body { background:#eee; font-family: 'Montserrat', sans-serif;}
		.quebrar { page-break-before: always; }
		table {width: 100%;
    margin: 0;
    border-collapse: collapse;
font-size: 10pt}
.pop {
		width: 500px;
    height: 500px;
    border-radius: 20px;
    margin: 40px auto;
    background: white;
    box-shadow: 0 0 10px #ddd;
    display: flex;
    flex-direction: column;
    flex-wrap: wrap;
    align-content: center;
    align-items: center;
    justify-content: space-evenly;
}
td	{ padding-left:5px }
    textarea {
    width: 350px;
    max-width: 350px;
    max-height: 300px;
    min-width: 350px;
    margin: 30px auto;
    height: 300px;
    border: 0;
    font-size: 4pt;
    background: #Eee;
    border-radius: 25px;
    overflow: hidden;
    min-height: 300px;
    padding: 20px;}
    .botao {
    	width: 100px;
    display: block;
    margin: auto;
    padding: 10px 20px;
    background: linear-gradient(90deg, #2c5cf1, #1e3c9a);
    border-radius: 25px;
    text-align: center;
    color: #eee;
    cursor: pointer;
    }
    #print { 
    opacity:0.2; }

    .btPrint { 
        position: fixed;
    bottom: 30px;
    right: 30px; }
    .btPrint span {
    	font-size: 3rem;
    background: linear-gradient(90deg, #2c5cf1, #1e3c9a);
    padding: 20px;
    border-radius: 50px;
    box-shadow: 0 0 10px #949494;
    color: #eee;
    cursor: pointer;
    opacity: 0.2;
    }
    .modulo {
    	background: white;
    width: 100px;
    padding: 8px 18px;
    border-radius: 25px;
    color: #1e3c9a;
    }
    .limpar {
    	    padding: 1px;
    width: 136px;
    }

@media print{ 
	.esconder { display:none; }
}
	</style>
</head>
<body>
	<div class="pop esconder">
		
	<textarea maxli id="dados" name="dados"></textarea>
	<div style="display:flex;width: 100%;flex-direction: row;flex-wrap: nowrap;justify-content: space-evenly;">		
		<div class="botao" onclick="gerarDados()">GERAR</div>
		<div class="botao limpar" onclick="limparDados()"><div class="modulo">LIMPAR</div></div>
	</div>
	</div>

<div class="btPrint esconder" onclick="imprimir()"><span id="print2" class="material-symbols-outlined">
print
</span></div>
<script type="text/javascript">
	let podeImprimir = false;
	function gerarDados(){
		const dadosGerais = document.getElementById('dados').value;
		const saida = document.getElementById('saida');
		var linhas = dadosGerais.split("\n");

		//remover primeira linha
		linhas.shift();



		if(dadosGerais == ""){ 
			alert("Por favor, né?!");

		}else{
		var out = "";
		//bloco filtrar localizacao
		let med = [], perf = [], dermo =[], alim = [], outros = [], med2 = [], perf2=[], dermo2=[],alim2=[];
    	for (var i in linhas) {
    		var linha = linhas[i].split("	");
    		var localizador = linha[14];

    		if(localizador == undefined){
    			continue;
    		}else {
    		}

    		//separar e organizar pelo mais pedido
    		var filtro = localizador.split("-");

    		switch (filtro[0]) {
    			case "V41":
    				let objPer = {
    					"codigo" : 		linha[12],
    					"descricao" : 	linha[13],
    					"localizacao" : linha[14],
    					"pedida" : 		linha[16],
    				}
    				if(parseInt(filtro[2]) > 100){
    					perf2.push(objPer);
	    				perf2.sort(function(a,b){
	    					return b.pedida - a.pedida;
	    				});
    				}else{
	    				perf.push(objPer);
	    				perf.sort(function(a,b){
	    					return b.pedida - a.pedida;
	    				});
    				}

    				break;
    			case "V43":
    				let objMed = {
    					"codigo" : 		linha[12],
    					"descricao" : 	linha[13],
    					"localizacao" : linha[14],
    					"pedida" : 		linha[16],
    				}
    				if(parseInt(filtro[2]) > 100){
    					med2.push(objMed);
	    				med2.sort(function(a,b){
	    					return b.pedida - a.pedida;
	    				});
    				}else{
	    				med.push(objMed);
	    				med.sort(function(a,b){
	    					return b.pedida - a.pedida;
	    				});
    				}
    				
    				break;
    			default:
    				var local = filtro[0][0] + filtro[0][1];
    				if(local == "VW"){ 
    					let objDermo = {
    					"codigo" : 		linha[12],
    					"descricao" : 	linha[13],
    					"localizacao" : linha[14],
    					"pedida" : 		linha[16],
    				}
    				if(filtro[1] == "01"){ 
    					dermo.push(objDermo);
    					dermo.sort(function(a,b){
    						return b.pedida - a.pedida;
    					});
    				}else{
    					dermo2.push(objDermo);
    					dermo2.sort(function(a,b){
    						return b.pedida - a.pedida;
    					});
    				}

    				}else if(local == "VY"){
    					let objAlim = {
    					"codigo" : 		linha[12],
    					"descricao" : 	linha[13],
    					"localizacao" : linha[14],
    					"pedida" : 		linha[16]
    				}
    				if(filtro[1] == "01"){ 
    					alim.push(objAlim);
    					alim.sort(function(a,b){
    						return b.pedida - a.pedida;});
    				}else{
    					alim2.push(objAlim);
    					alim2.sort(function(a,b){
    						return b.pedida - a.pedida;});
    				}
    				}else{ 
	    						//out += "--> outros\n";
	    						let objOut = {
	    						"codigo" : 		linha[12],
	    						"descricao" : 	linha[13],
	    						"localizacao" : linha[14],
	    						"pedida" : 		linha[16],
	    					}
	    					outros.push(objOut);
	    					outros.sort(function(a,b){
	    						return b.pedida - a.pedida;
	    					});
    				}
    				break;
    		}
		}

		//filtrar os 30 mais
		med = filtrarTrinta(med);
		med2 = filtrarTrinta(med2);
		perf = filtrarTrinta(perf);
		perf2 = filtrarTrinta(perf2);
		dermo = filtrarTrinta(dermo);
		dermo2 = filtrarTrinta(dermo2);
		alim = filtrarTrinta(alim);
		alim2 = filtrarTrinta(alim2);
		
		function filtrarTrinta(a){
			if(a.length > 30){ 
				a.splice(30, parseInt(a.length - 30));
			}
			return a;
		}

		//ordenar por endereco
		perf = ordemLocalizacao(perf);
		perf2 = ordemLocalizacao(perf2);
		med = ordemLocalizacao(med);
		med2 = ordemLocalizacao(med2);
		dermo = ordemLocalizacao(dermo);
		dermo2 = ordemLocalizacao(dermo2);
		alim = ordemLocalizacao(alim);
		alim2 = ordemLocalizacao(alim2);

		function ordemLocalizacao(c){
			 c.sort(function(a,b) {
   			 return a.localizacao < b.localizacao ? -1 : a.localizacao > b.localizacao ? 1 : 0;
			} );
			return c;		 
		}   		

		//mostrar tabela na tela
   		document.getElementById("tabMed").innerHTML = montarTabela(med, "MEDICAMENTOS");
   		document.getElementById("tabMed2").innerHTML = montarTabela(med2, "MEDICAMENTOS");
   		document.getElementById("tabPer").innerHTML = montarTabela(perf, "PERFUMARIA");
   		document.getElementById("tabPer2").innerHTML = montarTabela(perf2, "PERFUMARIA");
   		document.getElementById("tabDer").innerHTML = montarTabela(dermo, "DERMO");
   		document.getElementById("tabDer2").innerHTML = montarTabela(dermo2, "DERMO");
   		document.getElementById("tabOut").innerHTML = montarTabela(alim, "ALIMENTO");
   		document.getElementById("tabOut2").innerHTML = montarTabela(alim2, "ALIMENTO");
   		//document.getElementById("tabOut").innerHTML = montarTabela(outros, "OUTROS");

   		//liberar botao de imprimir
   		document.getElementById("print2").style = 'opacity:1';
   		podeImprimir = true;
   	}

}

function montarTabela(dado, titulo){
   			var ret = '<tr><th colspan="6">' + titulo + '</th></tr><tr><th>Codigo</th><th>Descrição</th><th>Localização</th><th>Qtd Pedida</th><th>Status</th></tr>';
   			for(var j = 0; j < 30; j++){
   				if(dado[j] != undefined){
   					ret += "<tr>" + 
   							"<td>" + dado[j]["codigo"] + "</td>" +
   							"<td>" + dado[j]["descricao"] + "</td>" +
   							"<td>" + dado[j]["localizacao"] + "</td>" +
   							"<td>" + dado[j]["pedida"] + "</td>" +
   							"<td></td>" +
   							"</tr>";
   				}else{ 
   					ret += "<tr>" + 
   						"<td>" + "-" + "</td>" +
   						"<td>" + "-" + "</td>" +
   						"<td>" + "-" + "</td>" +
   						"<td>" + "-" + "</td>" +
   						"<td>" + "-" + "</td>" +
   						"</tr>";
   				}

   			}
   			return ret;
   		} 

function imprimir(){

	if(podeImprimir){
		window.print();
	}else{ 
		alert("Preencha a lista");
	}
}

function limparDados(){
	document.getElementById('dados').value = "";
}
</script>

<table border="1" id="tabMed" style="width:100%"></table>
<p class="quebrar"></p>
<table border="1" id="tabMed2" style="width:100%"></table>
<p class="quebrar"></p>
<table border="1" id="tabPer" style="width:100%"></table>
<p class="quebrar"></p>
<table border="1" id="tabPer2" style="width:100%"></table>
<p class="quebrar"></p>
<table border="1" id="tabDer" style="width:100%"></table>
<p class="quebrar"></p>
<table border="1" id="tabDer2" style="width:100%"></table>
<p class="quebrar"></p>
<table border="1" id="tabOut" style="width:100%"></table>
<p class="quebrar"></p>
<table border="1" id="tabOut2" style="width:100%"></table>


</body>
</html>
